import{a as _,b as p,Q as u}from"./QItem.fa8636d8.js";import{h as S,av as w,aw as q,E as I,G as a,H as c,L as n,t,I as i,S as l,M as r,V as y,Q as h,F as R,ay as k,K as b,aA as C,aC as F,O as f,aG as L,ax as z,Y as N,aB as W}from"./index.7a0464ee.js";import{g as Y,Q as O}from"./QInput.62cb7953.js";import{Q as v}from"./QList.e5a0038a.js";import{Q as U}from"./QCheckbox.b4dcaa72.js";import{Q as D,a as G}from"./QLinearProgress.16f968c0.js";import{b as j,Q as H}from"./QSpinnerDots.49327f1a.js";import{p as M,R as K,M as B,W as Q,a as P,u as T,v as E,f as J}from"./ui.64f31f6c.js";import{u as V}from"./restore.39452529.js";import"./use-timeout.7d10f4b4.js";import"./use-key-composition.bcfc5dfb.js";import"./private.use-form.bc7d990f.js";import"./position-engine.61adaaf2.js";import"./selection.76f2443b.js";import"./scroll.fc385f1c.js";import"./index.81b98c8b.js";import"./i18n.e67af30b.js";const X=S({name:"NostrMintRestore",props:{mnemonic:{type:String,required:!0},isMnemonicValid:{type:Boolean,required:!0}},data(){return{hasSearched:!1,addingMints:!1,mintInfoCache:new Map,fetchingMintInfo:new Set}},computed:{...w(Q,["discoveredMints","searchInProgress"]),...w(P,["mints"]),availableMints(){return this.discoveredMints.filter(e=>!this.mintExists(e.url))},selectedMints(){return this.availableMints.filter(e=>e.selected)},allSelected(){return this.availableMints.length>0&&this.availableMints.every(e=>e.selected)},anySelected(){return this.availableMints.some(e=>e.selected)}},watch:{discoveredMints:{handler(e){e&&e.length>0&&this.fetchMintInfoForDiscoveredMints()},immediate:!0}},methods:{...q(Q,["searchMintsOnNostr","toggleMintSelection","selectAllMints","deselectAllMints","addSelectedMintsToWallet","clearDiscoveredMints"]),async searchForMints(){if(!this.isMnemonicValid){M(this.$t("RestoreView.nostr_mints.invalid_mnemonic"));return}try{await this.searchMintsOnNostr(this.mnemonic),this.hasSearched=!0}catch(e){console.error("Failed to search for mints:",e),M(this.$t("RestoreView.nostr_mints.search_error"))}},async addSelectedMints(){if(this.selectedMints.length!==0){this.addingMints=!0;try{await this.addSelectedMintsToWallet(this.selectedMints),this.deselectAllMints()}catch(e){console.error("Failed to add selected mints:",e),M(this.$t("RestoreView.nostr_mints.add_error"))}finally{this.addingMints=!1}}},mintExists(e){return this.mints.some(s=>s.url===e)},getShortUrl(e){return Y(e)},formatDate(e){return K.formatDate(e*1e3,"MMM DD, YYYY")},async fetchMintInfoForDiscoveredMints(){this.availableMints.forEach(async s=>{if(!this.mintInfoCache.has(s.url)&&!this.fetchingMintInfo.has(s.url)){this.fetchingMintInfo.add(s.url);try{const m=await this.fetchMintInfo(s.url);this.mintInfoCache.set(s.url,m),this.$forceUpdate()}catch(m){console.error(`Failed to fetch mint info for ${s.url}:`,m),this.mintInfoCache.set(s.url,null)}finally{this.fetchingMintInfo.delete(s.url)}}})},async fetchMintInfo(e){try{const s={url:e,keys:[],keysets:[]};return await new B(s).api.getInfo()}catch(s){throw console.error(`Error fetching mint info for ${e}:`,s),s}},getMintInfo(e){return this.mintInfoCache.get(e)},getMintIconUrl(e){const s=this.getMintInfo(e);return s&&s.icon_url?s.icon_url:null},getMintDisplayName(e){const s=this.getMintInfo(e);return s&&s.name?s.name:this.getShortUrl(e)},isFetchingMintInfo(e){return this.fetchingMintInfo.has(e)}},beforeUnmount(){this.clearDiscoveredMints(),this.mintInfoCache.clear(),this.fetchingMintInfo.clear()}}),Z={class:"nostr-mint-restore"},ee={class:"q-px-xs text-left q-mt-md"},te={class:"q-pb-md q-px-xs text-left"},se={key:0,class:"q-px-xs"},ie={class:"primary-action-section q-px-sm q-pb-md"},ne={class:"selection-buttons q-px-sm q-pb-md"},re={class:"row items-center"},oe={class:"mint-info-container"},le={key:1,class:"q-px-xs text-center q-py-lg"},ae={class:"text-grey-6 q-mt-sm"},de={class:"text-grey-5 caption q-mt-xs"};function ce(e,s,m,$,x,A){return a(),c("div",Z,[n("div",ee,[t(v,{padding:""},{default:i(()=>[t(_,null,{default:i(()=>[t(p,null,{default:i(()=>[t(u,{overline:"",class:"text-weight-bold"},{default:i(()=>[l(r(e.$t("RestoreView.nostr_mints.label")),1)]),_:1}),t(u,{caption:""},{default:i(()=>[l(r(e.$t("RestoreView.nostr_mints.caption")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),n("div",te,[t(h,{class:"q-ml-sm q-px-md",color:"secondary",size:"md",rounded:"",dense:"",outline:"",onClick:e.searchForMints,disabled:!e.isMnemonicValid||e.searchInProgress,loading:e.searchInProgress},{default:i(()=>[t(y,{name:"search",class:"q-mr-sm"}),l(" "+r(e.$t("RestoreView.nostr_mints.search_button")),1)]),_:1},8,["onClick","disabled","loading"])]),e.availableMints.length>0?(a(),c("div",se,[n("div",ie,[t(h,{color:"primary",size:"md",rounded:"",onClick:e.addSelectedMints,loading:e.addingMints,disabled:e.addingMints||e.selectedMints.length===0,class:"q-px-lg"},{default:i(()=>[t(y,{name:"add",class:"q-mr-sm"}),l(" "+r(e.$t("RestoreView.nostr_mints.add_selected",{count:e.selectedMints.length})),1)]),_:1},8,["onClick","loading","disabled"])]),n("div",ne,[t(h,{flat:"",dense:"",size:"md",color:"primary",onClick:e.selectAllMints,disabled:e.allSelected,class:"q-mr-md q-px-md"},{default:i(()=>[l(r(e.$t("RestoreView.nostr_mints.select_all")),1)]),_:1},8,["onClick","disabled"]),t(h,{flat:"",dense:"",size:"md",color:"grey",onClick:e.deselectAllMints,disabled:!e.anySelected,class:"q-px-md"},{default:i(()=>[l(r(e.$t("RestoreView.nostr_mints.deselect_all")),1)]),_:1},8,["onClick","disabled"])]),t(v,{padding:"",class:"discovered-mints-list"},{default:i(()=>[(a(!0),c(R,null,k(e.availableMints,d=>(a(),b(_,{key:d.url,clickable:"",onClick:o=>e.toggleMintSelection(d.url),class:L(["mint-item",{"mint-item-selected":d.selected}])},{default:i(()=>[t(p,{avatar:""},{default:i(()=>[t(U,{"model-value":d.selected,"onUpdate:modelValue":o=>e.toggleMintSelection(d.url),onClick:s[0]||(s[0]=C(()=>{},["stop"])),color:"primary",class:"clickable-checkbox"},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),t(p,{class:"text-left"},{default:i(()=>[n("div",re,[e.getMintIconUrl(d.url)?(a(),b(F,{key:0,size:"34px",class:"q-mr-sm"},{default:i(()=>[t(D,{"spinner-color":"white","spinner-size":"xs",src:e.getMintIconUrl(d.url),alt:"Mint Icon",style:{height:"34px","max-width":"34px","font-size":"12px"}},null,8,["src"])]),_:2},1024)):e.isFetchingMintInfo(d.url)?(a(),b(j,{key:1,size:"34px",color:"grey-5",class:"q-mr-sm"})):f("",!0),n("div",oe,[t(u,{lines:"1",class:"text-weight-medium text-left mint-name"},{default:i(()=>[l(r(e.getMintDisplayName(d.url)),1)]),_:2},1024),t(u,{caption:"",lines:"2",class:"text-grey-6 text-left mint-url"},{default:i(()=>[l(r(d.url),1)]),_:2},1024),t(u,{caption:"",class:"text-grey-5 q-pt-xs text-left"},{default:i(()=>[l(r(e.$t("RestoreView.nostr_mints.backed_up"))+": "+r(e.formatDate(d.timestamp)),1)]),_:2},1024)])])]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})])):e.hasSearched&&!e.searchInProgress?(a(),c("div",le,[t(y,{name:"cloud_off",size:"lg",color:"grey-5"}),n("div",ae,r(e.$t("RestoreView.nostr_mints.no_backups_found")),1),n("div",de,r(e.$t("RestoreView.nostr_mints.no_backups_hint")),1)])):f("",!0)])}var me=I(X,[["render",ce],["__scopeId","data-v-9c3af670"]]);const ue=S({name:"RestoreView",mixins:[windowMixin],components:{NostrMintRestore:me},data(){return{mnemonicError:"",restoreAllMintsText:this.$i18n.t("RestoreView.actions.restore_all_mints.label"),selectedMints:new Set}},computed:{...w(P,["mints"]),...z(J,["mnemonic"]),...z(V,["mnemonicToRestore","restoreProgress"]),...w(V,["restoringState","restoringMint","restoreStatus"]),isMnemonicValid(){return this.mnemonicToRestore?this.mnemonicToRestore.trim().split(/\s+/).length>=12:!1},allSelected(){return this.mints.length>0&&this.mints.every(e=>this.selectedMints.has(e.url))},anySelected(){return this.selectedMints.size>0},selectedMintsCount(){return this.selectedMints.size}},methods:{...q(V,["restoreMint"]),...q(T,["pasteFromClipboard"]),mintClass(e){return new B(e)},getMintIconUrl:function(e){if(e.info)return e.info.icon_url?e.info.icon_url:void 0},formatCurrency(e,s){return T().formatCurrency(e,s)},toggleMintSelection(e){this.selectedMints.has(e)?this.selectedMints.delete(e):this.selectedMints.add(e)},selectAllMints(){this.mints.forEach(e=>{this.selectedMints.add(e.url)})},deselectAllMints(){this.selectedMints.clear()},async restoreSelectedMints(){if(this.selectedMintsCount===0||!this.validateMnemonic())return;const e=Array.from(this.selectedMints);let s=0;try{for(const m of e)this.restoreAllMintsText=this.$i18n.t("RestoreView.actions.restore_selected_mints.in_progress",{index:++s,length:e.length}),await this.restoreMint(m);E(this.$i18n.t("RestoreView.actions.restore_selected_mints.success",{count:e.length})),this.deselectAllMints()}catch(m){console.error("Error restoring selected mints:",m),M(this.$i18n.t("RestoreView.actions.restore_selected_mints.error",{error:m.message||m}))}finally{this.restoreAllMintsText=this.$i18n.t("RestoreView.actions.restore_all_mints.label")}},validateMnemonic(){return this.mnemonicToRestore.trim().split(/\s+/).length<12?(this.mnemonicError=this.$i18n.t("RestoreView.actions.validate.error"),!1):(this.mnemonicError="",!0)},async restoreMintForMint(e){if(!!this.validateMnemonic())try{this.restoreAllMintsText=this.$i18n.t("RestoreView.actions.restore.in_progress"),await this.restoreMint(e)}catch(s){console.error("Error restoring mint:",s),M(this.$i18n.t("RestoreView.actions.restore.error",{error:s.message||s}))}finally{this.restoreAllMintsText=this.$i18n.t("RestoreView.actions.restore_all_mints.label")}},async pasteMnemonic(){try{const e=await this.pasteFromClipboard();this.mnemonicToRestore=e.trim()}catch{M(this.$i18n.t("RestoreView.actions.paste.error"))}},async restoreAllMints(){let e=0;if(!!this.validateMnemonic())try{for(const s of this.mints)this.restoreAllMintsText=this.$i18n.t("RestoreView.actions.restore_all_mints.in_progress",{index:++e,length:this.mints.length}),await this.restoreMint(s.url);E(this.$i18n.t("RestoreView.actions.restore_all_mints.success"))}catch(s){console.error("Error restoring mints:",s),M(this.$i18n.t("RestoreView.actions.restore_all_mints.error",{error:s.message||s}))}finally{this.restoreAllMintsText=this.$i18n.t("RestoreView.actions.restore_all_mints.label")}}}}),he={style:{"max-width":"800px",margin:"0 auto"}},fe={class:"q-px-xs text-left","on-left":""},pe={class:"row q-pt-md"},Me={class:"col-12"},ge={class:"q-px-xs text-left","on-left":""},_e={class:"q-px-xs text-left q-mt-md","on-left":""},ve={class:"q-pb-md q-px-xs text-left","on-left":""},ye={key:0,class:"primary-action-section q-px-sm q-pb-md"},be={key:1,class:"selection-buttons q-px-sm q-pb-md"},we={class:"q-pt-md"},$e={class:"full-width",style:{position:"relative"}},Ve={class:"row items-center q-pa-md"},qe={class:"col"},Re={class:"row items-center"},ke={class:"mint-info-container"},Ce={key:0,class:"mint-name"},Se={class:"text-grey-6 mint-url"},Ie={class:"row justify-between q-pb-md q-pl-lg q-pr-md"},xe={class:"col"},Ae={class:"row q-gutter-x-sm"},ze={class:"currency-unit-text"},Qe={key:0,class:"q-mt-sm"},Te={class:"text-grey-6 q-mb-xs",style:{"font-size":"12px"}},Ee={class:"col-auto"};function Fe(e,s,m,$,x,A){const d=N("NostrMintRestore");return a(),c("div",he,[n("div",fe,[t(v,{padding:""},{default:i(()=>[t(_,null,{default:i(()=>[t(p,null,{default:i(()=>[t(u,{overline:"",class:"text-weight-bold"},{default:i(()=>[l(r(e.$t("RestoreView.seed_phrase.label")),1)]),_:1}),t(u,{caption:""},{default:i(()=>[l(r(e.$t("RestoreView.seed_phrase.caption")),1)]),_:1}),n("div",pe,[n("div",Me,[t(O,{outlined:"",modelValue:e.mnemonicToRestore,"onUpdate:modelValue":s[0]||(s[0]=o=>e.mnemonicToRestore=o),label:e.$t("RestoreView.seed_phrase.inputs.seed_phrase.label"),autogrow:"",type:"textarea",error:e.mnemonicError!=="","error-message":e.mnemonicError},{append:i(()=>[t(h,{flat:"",dense:"",icon:"content_paste",onClick:e.pasteMnemonic,class:"cursor-pointer q-mt-md"},null,8,["onClick"])]),_:1},8,["modelValue","label","error","error-message"])])])]),_:1})]),_:1})]),_:1})]),n("div",ge,[t(v,{padding:""},{default:i(()=>[t(_,null,{default:i(()=>[t(p,null,{default:i(()=>[t(u,{overline:"",class:"text-weight-bold"},{default:i(()=>[l(r(e.$t("RestoreView.information.label")),1)]),_:1}),t(u,{caption:""},{default:i(()=>[l(r(e.$t("RestoreView.information.caption")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),n("div",_e,[t(v,{padding:""},{default:i(()=>[t(_,null,{default:i(()=>[t(p,null,{default:i(()=>[t(u,{overline:"",class:"text-weight-bold"},{default:i(()=>[l(r(e.$t("RestoreView.restore_mints.label")),1)]),_:1}),t(u,{caption:""},{default:i(()=>[l(r(e.$t("RestoreView.restore_mints.caption")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),n("div",ve,[e.mints.length>0?(a(),c("div",ye,[t(h,{color:"primary",size:"md",rounded:"",onClick:e.restoreSelectedMints,disabled:!e.isMnemonicValid||e.restoringState||e.selectedMintsCount===0,loading:e.restoringState,class:"q-px-lg"},{default:i(()=>[t(y,{name:"restore",class:"q-mr-sm"}),l(" "+r(e.$t("RestoreView.actions.restore_selected_mints.label",{count:e.selectedMintsCount})),1)]),_:1},8,["onClick","disabled","loading"])])):f("",!0),e.mints.length>0?(a(),c("div",be,[t(h,{flat:"",dense:"",size:"md",color:"primary",onClick:e.selectAllMints,disabled:e.allSelected,class:"q-mr-md q-px-md"},{default:i(()=>[l(r(e.$t("RestoreView.actions.select_all.label")),1)]),_:1},8,["onClick","disabled"]),t(h,{flat:"",dense:"",size:"md",color:"grey",onClick:e.deselectAllMints,disabled:!e.anySelected,class:"q-px-md"},{default:i(()=>[l(r(e.$t("RestoreView.actions.deselect_all.label")),1)]),_:1},8,["onClick","disabled"])])):f("",!0),n("div",we,[(a(!0),c(R,null,k(e.mints,o=>(a(),c("div",{key:o.url,class:"q-px-md q-mb-md"},[t(_,{clickable:"",onClick:g=>e.toggleMintSelection(o.url),class:"mint-card cursor-pointer",style:W({"border-radius":"10px",border:e.selectedMints.has(o.url)?"1px solid var(--q-primary)":"1px solid rgba(128, 128, 128, 0.2)",padding:"0px",position:"relative","background-color":e.selectedMints.has(o.url)?"rgba(var(--q-primary-rgb), 0.1)":"transparent"}),disable:!e.isMnemonicValid||e.restoringState},{default:i(()=>[n("div",$e,[n("div",Ve,[t(p,{avatar:""},{default:i(()=>[t(U,{"model-value":e.selectedMints.has(o.url),"onUpdate:modelValue":g=>e.toggleMintSelection(o.url),onClick:s[1]||(s[1]=C(()=>{},["stop"])),color:"primary",class:"clickable-checkbox"},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),n("div",qe,[n("div",Re,[e.getMintIconUrl(o)?(a(),b(F,{key:0,size:"34px",class:"q-mr-sm"},{default:i(()=>[t(D,{"spinner-color":"white","spinner-size":"xs",src:e.getMintIconUrl(o),alt:"Mint Icon",style:{height:"34px","max-width":"34px","font-size":"12px"}},null,8,["src"])]),_:2},1024)):f("",!0),n("div",ke,[o.nickname||o.info?.name?(a(),c("div",Ce,r(o.nickname||o.info?.name),1)):f("",!0),n("div",Se,r(o.url),1)])])])]),n("div",Ie,[n("div",xe,[n("div",Ae,[(a(!0),c(R,null,k(e.mintClass(o).units,g=>(a(),c("div",{key:g,class:"currency-unit-badge"},[n("span",ze,r(e.formatCurrency(e.mintClass(o).unitBalance(g),g)),1)]))),128))]),e.restoringMint===o.url?(a(),c("div",Qe,[n("div",Te,r(e.restoreStatus),1),t(G,{value:e.restoreProgress,color:"primary",style:{height:"4px","border-radius":"2px"}},null,8,["value"])])):f("",!0)]),n("div",Ee,[t(h,{color:"secondary",size:"sm",rounded:"",dense:"",flat:"",onClick:C(g=>e.restoreMintForMint(o.url),["stop"]),disabled:!e.isMnemonicValid||e.restoringState,loading:e.restoringMint===o.url,icon:"restore",class:"q-px-sm"},{default:i(()=>[t(H,null,{default:i(()=>[l(r(e.$t("RestoreView.actions.restore.label")),1)]),_:1})]),_:2},1032,["onClick","disabled","loading"])])])])]),_:2},1032,["onClick","style","disable"])]))),128))])]),t(d,{mnemonic:e.mnemonicToRestore,"is-mnemonic-valid":e.isMnemonicValid},null,8,["mnemonic","is-mnemonic-valid"])])}var Ne=I(ue,[["render",Fe]]);const Ue=S({name:"ErrorNotFound",components:{RestoreView:Ne}}),De={class:"bg-dark text-white text-center q-pa-md flex flex-center"};function Be(e,s,m,$,x,A){const d=N("RestoreView");return a(),c("div",De,[t(d)])}var rt=I(Ue,[["render",Be]]);export{rt as default};
