import{Q}from"./QSpinnerHourglass.d80217d7.js";import{h as K,l as _,E as z,G as g,H as w,L as n,t as A,V as j,F as E,ay as L,M as T,O as C,W as Y,X as V,r as U,o as Z,aG as G,aB as O,Y as F,S,I as J,J as tt,j as P}from"./index.7a0464ee.js";import{e as et,f as st,a as nt}from"./ui.64f31f6c.js";import{g as at}from"./QInput.62cb7953.js";const it=K({name:"MintAuditWarningBox",props:{mint:{type:Object,required:!0},swaps:{type:Array,required:!0},inactiveThresholdDays:{type:Number,default:2},recentDaysThreshold:{type:Number,default:7},successRateThreshold:{type:Number,default:85},slowMintThresholdMs:{type:Number,default:5e3},requiredSuccessfulSwaps:{type:Number,default:7}},setup(t){const l=_(()=>{const s=[],r=new Date,d=t.swaps.filter(m=>{const y=new Date(m.created_at);return(r.getTime()-y.getTime())/(1e3*60*60*24)<=t.recentDaysThreshold}),a=d.filter(m=>m.state==="OK"),h=d.length>0?a.length/d.length*100:0;if(t.mint.state==="WARN"||t.mint.state==="ERROR"){const m="The last swap attempt has failed.";if(d.length>0){let y=`${a.length} of ${d.length} swaps in the last ${t.recentDaysThreshold} days succeeded.`;h>=t.successRateThreshold?s.push(`${m} However, ${y} This mint seems reliable, failures might be due to the receiving mint.`):s.push(`${m} Only ${y} This mint might be unreliable.`)}else s.push(m)}else if(t.mint.state==="UNKNOWN")s.push("The auditor was not able to determine the quality of this mint yet.");else if(t.mint.state==="OK"){const m=[];a.length<t.requiredSuccessfulSwaps&&m.push(`The auditor does not have enough recent data on this mint. There were only ${a.length} successful ${a.length===1?"swap":"swaps"} in the last ${t.recentDaysThreshold} days.`),d.length>0&&h<t.successRateThreshold&&m.push(`In the last ${t.recentDaysThreshold} days, this mint had a success rate of ${Math.round(h)}%, below the recommended ${t.successRateThreshold}%.`),m.length>0&&s.push(...m)}const u=t.swaps.filter(m=>m.state==="OK");if(u.length>0){const m=new Date(u[0].created_at),I=(new Date().getTime()-m.getTime())/(1e3*60*60*24);if(I>t.inactiveThresholdDays){const M=Math.floor(I),D=`This mint had no swaps for ${M} ${M===1?"day":"days"}. It might be unreachable.`;s.push(D)}const k=u.filter(M=>M.time_taken);if(k.length>0){const D=k.reduce(($,N)=>$+(N.time_taken||0),0)/k.length;if(D>t.slowMintThresholdMs){const $=(D/1e3).toFixed(1);s.push(`This mint is slow. Payments from this mint took ${$} seconds on average.`)}}}else t.swaps.length>0&&s.push("No successful swaps recorded for this mint. It might be unreachable.");return s}),c=_(()=>l.value.length>0);return{warningMessages:l,hasWarnings:c}}}),ot=t=>(Y("data-v-722b1bee"),t=t(),V(),t),rt={key:0,class:"warning-container"},lt={class:"warning-content"},ct={class:"warning-text-container"},dt=ot(()=>n("div",{class:"warning-header"},[n("div",{class:"warning-title"},"Auditor Warnings")],-1)),ut={class:"warning-messages"},ht={class:"warning-list"};function mt(t,l,c,s,r,d){return t.hasWarnings?(g(),w("div",rt,[n("div",lt,[A(j,{name:"warning",size:"24px",class:"warning-icon"}),n("div",ct,[dt,n("div",ut,[n("ul",ht,[(g(!0),w(E,null,L(t.warningMessages,(a,h)=>(g(),w("li",{key:h,class:"warning-message"},T(a),1))),128))])])])])])):C("",!0)}var ft=z(it,[["render",mt],["__scopeId","data-v-722b1bee"]]);const pt=K({name:"MintAuditSwapsBarChart",props:{swaps:{type:Array,required:!0},minBars:{type:Number,default:16},maxPossibleBars:{type:Number,default:200},barSpacing:{type:Number,default:2},minBarWidth:{type:Number,default:2}},setup(t){const l=U({show:!1,x:0,y:0,content:""}),c=U(null),s=U(0),r=_(()=>t.barSpacing),d=_(()=>t.minBarWidth),a=_(()=>[...t.swaps].sort((e,i)=>new Date(e.created_at).getTime()-new Date(i.created_at).getTime())),h=_(()=>{if(s.value<=0)return t.minBars;const e=200,i=2600;if(s.value<=e)return t.minBars;if(s.value>=i)return t.maxPossibleBars;{const p=(s.value-e)/(i-e);return Math.floor(t.minBars+p*(t.maxPossibleBars-t.minBars))}}),u=_(()=>{if(s.value<=0)return h.value;const e=Math.floor((s.value+r.value)/(d.value+r.value));return Math.min(e,h.value)}),m=_(()=>s.value<=0||u.value<=0?d.value:Math.max(d.value,(s.value-r.value*(u.value-1))/u.value)),y=()=>{if(c.value){const e=c.value.querySelector(".bars-container");e&&(s.value=e.clientWidth)}};Z(()=>{y();const e=new ResizeObserver(()=>{y()});return c.value&&e.observe(c.value),window.addEventListener("resize",y),()=>{e.disconnect(),window.removeEventListener("resize",y)}});const I=_(()=>{if(a.value.length===0)return[];const e=new Date(a.value[0].created_at).getTime(),i=new Date(a.value[a.value.length-1].created_at).getTime(),p=(e-i)/3;return Array.from({length:4},(o,v)=>new Date(i+p*v))}),k=_(()=>{if(a.value.length===0)return Array(u.value).fill({swaps:[],count:0,successCount:0,successRate:0,startTime:new Date,endTime:new Date});const e=new Date(a.value[a.value.length-1].created_at).getTime(),i=new Date(a.value[0].created_at).getTime(),p=e-i,o=Array(u.value).fill(null).map(()=>({swaps:[],count:0,successCount:0,successRate:0,startTime:new Date,endTime:new Date}));if(p===0)return o[0].swaps=[...a.value],o[0].count=a.value.length,o[0].successCount=a.value.filter(f=>f.state==="OK").length,o[0].successRate=o[0].count>0?o[0].successCount/o[0].count:0,o[0].startTime=new Date(i),o[0].endTime=new Date(e),o;const v=p/u.value;for(let f=0;f<u.value;f++){const q=u.value-1-f,b=i+q*v,W=i+(q+1)*v;o[f].startTime=new Date(b),o[f].endTime=new Date(W)}return a.value.forEach(f=>{const b=(new Date(f.created_at).getTime()-i)/p,W=1-b,B=Math.min(Math.floor(W*u.value),u.value-1);B>=0&&(o[B].swaps.push(f),o[B].count++,f.state==="OK"&&o[B].successCount++)}),o.forEach(f=>{f.successRate=f.count>0?f.successCount/f.count:0}),o}),M=e=>{if(e===1)return"#4CAF50";if(e===0)return"#f44336";if(e<.5){const p=Math.floor(67+e*2*98);return`rgb(${244}, ${p}, ${54})`}else{const i=Math.floor(244-(e-.5)*2*168),p=Math.floor(165+(e-.5)*2*(175-165)),o=Math.floor(54-(e-.5)*2*(54-50));return`rgb(${i}, ${p}, ${o})`}},D=e=>{if(a.value.length>0){const f=new Date(a.value[a.value.length-1].created_at).getTime();if(Math.abs(e.getTime()-f)<1e3)return"Now"}const i=new Date,p=e.toDateString()===i.toDateString(),o=new Date(i.setDate(i.getDate()-1)).toDateString()===e.toDateString();let v="";return p?v="Today":o?v="Yesterday":v=e.toLocaleDateString(void 0,{month:"short",day:"numeric"}),`${v} ${e.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1})}`},$=e=>{const i=/([Zz]|[+\-]\d{2}:\d{2})$/.test(e);let p=e;i||(p+="Z");const o=new Date(p);if(isNaN(o.getTime()))return"Invalid Date";const v=new Date,f=o.toDateString()===v.toDateString(),q=new Date(v.setDate(v.getDate()-1)).toDateString()===o.toDateString();let b="";return f?b="Today":q?b="Yesterday":b=o.toLocaleDateString(void 0,{month:"short",day:"numeric"}),`${b} ${o.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1})}`},N=(e,i)=>{if(i.count===0){H();return}const p=Math.round(i.successRate*100);let o="";i.startTime&&i.endTime&&(o=`${$(i.startTime.toISOString())} - ${$(i.endTime.toISOString())}`),l.value={show:!0,x:e.clientX+10,y:e.clientY+10,content:`
          <div><b>Swaps:</b> ${i.count}</div>
          <div><b>Success rate:</b> ${p}% (${i.successCount}/${i.count})</div>
          <div><b>Time range:</b> ${o}</div>
        `}},H=()=>{l.value.show=!1};return{tooltip:l,timeTicks:I,displayBuckets:k,chartContainer:c,barsCount:u,barWidth:m,spacing:r,maxBars:h,formatTime:D,formatDate:$,showBucketTooltip:N,hideTooltip:H,getSuccessColor:M}}}),gt={class:"bar-chart-container",ref:"chartContainer"},wt={class:"chart-wrapper"},vt={class:"bars-container"},yt=["onMouseover"],_t={class:"time-axis"},Tt=["innerHTML"];function St(t,l,c,s,r,d){return g(),w("div",gt,[n("div",wt,[n("div",vt,[(g(!0),w(E,null,L(t.displayBuckets,(a,h)=>(g(),w("div",{key:`bucket-${h}`,class:G(["bar",{placeholder:a.count===0}]),style:O({width:`${t.barWidth}px`,left:`${h*(t.barWidth+t.spacing)}px`,backgroundColor:a.count>0?t.getSuccessColor(a.successRate):"transparent"}),onMouseover:u=>t.showBucketTooltip(u,a),onMouseleave:l[0]||(l[0]=(...u)=>t.hideTooltip&&t.hideTooltip(...u))},null,46,yt))),128))]),n("div",_t,[(g(!0),w(E,null,L(t.timeTicks,(a,h)=>(g(),w("div",{key:h,class:"time-tick",style:O({left:`${h/(t.timeTicks.length-1)*100}%`,display:h===t.timeTicks.length-1?"none":"block"})},T(t.formatTime(a)),5))),128))])]),t.tooltip.show?(g(),w("div",{key:0,class:"tooltip",style:O({left:t.tooltip.x+"px",top:t.tooltip.y+"px"})},[n("div",{innerHTML:t.tooltip.content},null,8,Tt)],4)):C("",!0)],512)}var bt=z(pt,[["render",St],["__scopeId","data-v-5dca3427"]]);const Mt={name:"MintAuditInfo",components:{MintAuditWarningBox:ft,MintAuditSwapsBarChart:bt},props:{mintUrl:{type:String,required:!0}},data(){const t=et();return{auditorApiUrl:t.auditorApiUrl,auditUrl:t.auditorUrl,auditUrlShort:at(t.auditorUrl),mintNotAudited:!1,loading:!0,error:null,couldFetchInfo:!0,mints:[],mintInfo:null,mintSwaps:[],limit:100,skip:0,allLoaded:!1,loadingMore:!1}},computed:{successfulSwaps(){return this.mintSwaps.filter(t=>t.state==="OK").length},successRate(){return this.mintSwaps.length===0?0:Math.round(this.successfulSwaps/this.mintSwaps.length*100)},averageTime(){const t=this.mintSwaps.filter(c=>c.state==="OK"&&c.time_taken);return t.length===0?0:t.reduce((c,s)=>c+(s.time_taken||0),0)/t.length}},async mounted(){try{this.loading=!0,await this.getMintInfo(),this.mintInfo&&this.mintInfo.id&&await this.getMintSwaps(this.mintInfo.id)}catch(t){this.error=t.message||"Failed to load mint data"}finally{this.loading=!1}},methods:{async getMintInfo(){try{const t=await fetch(`${this.auditorApiUrl}/mints/url?url=${this.mintUrl}`);if(!t.ok)throw t.status===404?(this.mintNotAudited=!0,new Error("This mint is not being audited yet.")):new Error(`API error: ${t.status}`);if(this.mintInfo=await t.json(),console.log("# MintAuditInfo",this.mintInfo),!this.mintInfo)throw this.mintNotAudited=!0,new Error("This mint is not being audited yet.")}catch(t){throw console.error("Error fetching mint info:",t),t}},async getMintSwaps(t,l=0,c=100){try{const s=await fetch(`${this.auditorApiUrl}/swaps/mint/${t}?skip=${l}&limit=${c}`);if(!s.ok)throw new Error(`API error: ${s.status}`);const r=await s.json();l===0?this.mintSwaps=r:this.mintSwaps=[...this.mintSwaps,...r],this.skip+=c,this.allLoaded=r.length<c}catch(s){throw console.error("Error fetching mint swaps:",s),s}},async getAuditorPaymentRequestsAndHandle(){const t=st(),l=nt();try{const d=(await(await fetch(`${this.auditorApiUrl}/pr?url=${this.mintUrl}`)).json()).pr.replace(/"/g,"");console.log("# AuditorPaymentRequests",d),await l.activateMintUrl(this.mintUrl),await l.activateUnit("points"),await t.decodeRequest(d),this.$emit("close")}catch(c){console.error("Error fetching auditor payment requests:",c)}},async loadMoreSwaps(){if(!(this.allLoaded||this.loadingMore||!this.mintInfo)){this.loadingMore=!0;try{await this.getMintSwaps(this.mintInfo.id,this.skip,this.limit)}finally{this.loadingMore=!1}}},formatTime(t){if(t===0)return"N/A";const l=t/1e3;return l<10?`${t.toFixed(0)} ms`:`${l.toFixed(2)} s`}}},x=t=>(Y("data-v-43946e90"),t=t(),V(),t),$t={class:"q-mt-lg q-mb-lg"},Dt={key:0,class:"text-caption q-mx-sm"},At={key:1,class:"q-mx-sm"},xt=x(()=>n("span",{class:"text-bold"},"This mint has not been audited yet.",-1)),It=x(()=>n("br",null,null,-1)),kt={class:"text-caption"},qt=["href"],Bt={key:2,class:"q-mx-sm text-bold"},Rt={key:3,class:"mint-info"},Ct={style:{"margin-bottom":"32px"}},Nt={class:"q-pb-none"},Wt={class:"row q-col-gutter-md q-px-md",style:{"flex-wrap":"nowrap"}},Ut={class:"col-6 stat-card"},Ot={class:"q-pa-md"},Et=x(()=>n("div",{class:"text-subtitle1"},"Success Rate",-1)),Lt={class:"text-h5"},Pt={class:"text-caption"},zt={class:"col-6 stat-card q-ml-md"},Ht={class:"q-pa-md"},Ft=x(()=>n("div",{class:"text-subtitle1"},"Average Time",-1)),Kt={class:"text-h5"},jt=x(()=>n("div",{class:"text-caption"},"For successful swaps",-1)),Yt={key:0,class:"q-py-md"},Vt=x(()=>n("div",{class:"q-mt-md text-grey-6 text-caption"}," Audit data is provided by independent third parties to help assess a mint\u2019s reliability over time. However, these results are informational only and do not guarantee the safety, solvency, or trustworthiness of any mint. Always conduct your own research and ensure you trust the mint operator before using their services. ",-1)),Xt={class:"q-mt-md text-grey-6 text-caption"},Qt=["href"],Zt={class:"text-bold"},Gt={class:"text-bold"};function Jt(t,l,c,s,r,d){const a=F("MintAuditWarningBox"),h=F("MintAuditSwapsBarChart");return g(),w("div",$t,[r.loading?(g(),w("div",Dt,[A(Q,{color:"grey",size:"20px",class:"q-mr-sm"}),S(" Loading audit info... ")])):r.mintNotAudited?(g(),w("div",At,[A(j,{name:"info_outline",color:"grey",size:"20px",class:"q-mr-sm",style:{"padding-bottom":"2px","margin-bottom":"2px"}}),xt,It,n("span",kt,[S(" To learn more about the auditor or support a future audit, visit "),n("a",{href:r.auditUrl},"audit.8333.space",8,qt),S(" or click "),n("span",{class:"text-bold cursor-pointer text-primary",onClick:l[0]||(l[0]=(...u)=>d.getAuditorPaymentRequestsAndHandle&&d.getAuditorPaymentRequestsAndHandle(...u))}," here "),S(" to donate ecash and help initiate an audit of this mint. ")])])):r.error?(g(),w("div",Bt,"Error: "+T(r.error),1)):r.mintInfo?(g(),w("div",Rt,[n("div",Ct,[A(tt,{appear:"","enter-active-class":"animated pulse",name:"smooth-slide"},{default:J(()=>[A(a,{mint:r.mintInfo,swaps:r.mintSwaps},null,8,["mint","swaps"])]),_:1})]),n("div",Nt,[n("div",Wt,[n("div",Ut,[n("div",Ot,[Et,n("div",Lt,T(d.successRate)+"%",1),n("div",Pt,T(d.successfulSwaps)+" of "+T(r.mintSwaps.length)+" swaps ",1)])]),n("div",zt,[n("div",Ht,[Ft,n("div",Kt,T(d.formatTime(d.averageTime)),1),jt])])])]),r.mintSwaps.length>0?(g(),w("div",Yt,[A(h,{swaps:r.mintSwaps},null,8,["swaps"])])):C("",!0),Vt,n("div",Xt,[S(" Audit information is made available by "),n("a",{href:r.auditUrl},T(r.auditUrlShort),9,Qt),S(". The current balance held by the auditor for this mint is "),n("span",Zt,T(r.mintInfo.balance)+" points",1),S(", with a total of "),n("span",Gt,T(r.mintInfo.sum_donations)+" points",1),S(" donated so far. To support continued auditing, you can "),n("span",{class:"text-bold cursor-pointer text-primary",onClick:l[1]||(l[1]=(...u)=>d.getAuditorPaymentRequestsAndHandle&&d.getAuditorPaymentRequestsAndHandle(...u))}," press here "),S(" to donate ecash to the auditor. ")])])):C("",!0)])}var oe=z(Mt,[["render",Jt],["__scopeId","data-v-43946e90"]]);/**
 * @license lucide-vue-next v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();/**
 * @license lucide-vue-next v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var R={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide-vue-next v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=({size:t,strokeWidth:l=2,absoluteStrokeWidth:c,color:s,iconNode:r,name:d,class:a,...h},{slots:u})=>P("svg",{...R,width:t||R.width,height:t||R.height,stroke:s||R.stroke,"stroke-width":c?Number(l)*24/Number(t):l,class:["lucide",`lucide-${te(d??"icon")}`],...h},[...r.map(m=>P(...m)),...u.default?[u.default()]:[]]);/**
 * @license lucide-vue-next v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=(t,l)=>(c,{slots:s})=>P(ee,{...c,iconNode:l,name:t},s);/**
 * @license lucide-vue-next v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=X("InfoIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-vue-next v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=X("XIcon",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);export{re as I,oe as M,le as X,X as c};
